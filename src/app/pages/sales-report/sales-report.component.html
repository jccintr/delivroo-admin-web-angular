<div class="container mx-auto px-4 py-8 max-w-7xl">
  <!-- Seleção de mês e ano + botão -->
  <div class="flex flex-col md:flex-row justify-center items-center gap-4 mb-10 bg-white p-6 rounded-xl shadow-sm border border-gray-200">
    <div class="w-full md:w-auto">
      <label class="block text-sm font-medium text-gray-700 mb-1">Mês</label>
      <select 
        [(ngModel)]="selectedMonth" 
        (ngModelChange)="atualizarNomeMes()"
        class="w-full md:w-48 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none"
      >
        <option *ngFor="let m of months" [value]="m.value">{{ m.label }}</option>
      </select>
    </div>

    <div class="w-full md:w-auto">
      <label class="block text-sm font-medium text-gray-700 mb-1">Ano</label>
      <select 
        [(ngModel)]="selectedYear" 
        class="w-full md:w-48 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none"
      >
        <option *ngFor="let y of years">{{ y }}</option>
      </select>
    </div>

    <button 
      (click)="gerarRelatorio()"
      [disabled]="isLoading"
      class="mt-6 md:mt-0 px-8 py-3 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
    >
      <span *ngIf="isLoading" class="animate-spin inline-block h-5 w-5 border-2 border-white border-t-transparent rounded-full"></span>
      {{ isLoading ? 'Carregando...' : 'Gerar Relatório' }}
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="text-center py-32 text-gray-600">
    <div class="animate-spin inline-block h-12 w-12 border-4 border-indigo-500 border-t-transparent rounded-full mb-4"></div>
    <p class="text-xl">Carregando relatório de vendas...</p>
  </div>

  <!-- Conteúdo principal -->
  <div *ngIf="!isLoading">
    <h1 class="text-4xl font-bold text-center text-gray-800 mb-2">Relatório de Vendas</h1>
    <p class="text-center text-gray-600 text-lg mb-10">{{ nomeMes }}/{{ selectedYear }}</p>

    <!-- 1. Resumo Geral -->
    <section class="mb-12">
      <h2 class="text-2xl font-semibold text-indigo-700 border-b-2 border-indigo-200 pb-3 mb-6">1. Resumo Geral</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 text-center">
          <p class="text-sm text-gray-600">Total de Pedidos</p>
          <p class="text-3xl font-bold text-green-600">{{ totalPedidos }}</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 text-center">
          <p class="text-sm text-gray-600">Faturamento Total</p>
          <p class="text-3xl font-bold text-gray-900">R$ {{ faturamentoTotal.toFixed(2) }}</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 text-center">
          <p class="text-sm text-gray-600">Taxas de Entrega</p>
          <p class="text-2xl font-semibold text-gray-800">R$ {{ taxasEntrega.toFixed(2) }}</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 text-center">
          <p class="text-sm text-gray-600">Descontos Aplicados</p>
          <p class="text-2xl font-semibold text-gray-800">R$ {{ descontos.toFixed(2) }}</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 text-center">
          <p class="text-sm text-gray-600">Média por Pedido</p>
          <p class="text-2xl font-semibold text-gray-800">R$ {{ mediaPedido.toFixed(2) }}</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 text-center">
          <p class="text-sm text-gray-600">Dias com Vendas</p>
          <p class="text-2xl font-semibold text-gray-800">{{ diasVendas }}</p>
        </div>
      </div>
    </section>

    <!-- 2. Delivery vs Balcão -->
    <section class="mb-12">
      <h2 class="text-2xl font-semibold text-indigo-700 border-b-2 border-indigo-200 pb-3 mb-6">2. Delivery vs Balcão</h2>
      <div class="overflow-x-auto mb-6">
        <table class="min-w-full bg-white border border-gray-200 rounded-lg">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Tipo</th>
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Contagem</th>
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Percentual</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <tr>
              <td class="px-6 py-5 text-sm text-gray-900">Delivery</td>
              <td class="px-6 py-5 text-sm text-gray-900">{{ deliveryData?.delivery || 0 }}</td>
              <td class="px-6 py-5 text-sm text-gray-900">{{ deliveryData?.percDelivery || '0%' }}</td>
            </tr>
            <tr>
              <td class="px-6 py-5 text-sm text-gray-900">Balcão/Retirada</td>
              <td class="px-6 py-5 text-sm text-gray-900">{{ deliveryData?.balcao || 0 }}</td>
              <td class="px-6 py-5 text-sm text-gray-900">{{ deliveryData?.percBalcao || '0%' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="h-80 mx-auto max-w-lg" *ngIf="dadosCarregados">
        <canvas id="deliveryChart"></canvas>
      </div>
    </section>

    <!-- 3. Formas de Pagamento -->
    <section class="mb-12">
      <h2 class="text-2xl font-semibold text-indigo-700 border-b-2 border-indigo-200 pb-3 mb-6">3. Formas de Pagamento</h2>
      <div class="overflow-x-auto mb-6">
        <table class="min-w-full bg-white border border-gray-200 rounded-lg">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Forma de Pagamento</th>
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Contagem</th>
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Percentual</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <tr *ngFor="let p of pagamentoData">
              <td class="px-6 py-5 text-sm text-gray-900">{{ p.forma }}</td>
              <td class="px-6 py-5 text-sm text-gray-900">{{ p.contagem }}</td>
              <td class="px-6 py-5 text-sm text-gray-900">{{ p.percentual }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="h-80 mx-auto max-w-lg" *ngIf="dadosCarregados">
        <canvas id="pagamentoChart"></canvas>
      </div>
    </section>

    <!-- 4. Top 6 Produtos Mais Vendidos -->
    <section class="mb-12">
      <h2 class="text-2xl font-semibold text-indigo-700 border-b-2 border-indigo-200 pb-3 mb-6">4. Top 6 Produtos Mais Vendidos</h2>
      <div class="overflow-x-auto mb-6">
        <table class="min-w-full bg-white border border-gray-200 rounded-lg">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Produto</th>
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Quantidade Vendida</th>
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Receita Estimada</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <tr *ngFor="let p of produtosData">
              <td class="px-6 py-5 text-sm text-gray-900">{{ p.nome }}</td>
              <td class="px-6 py-5 text-sm text-gray-900">{{ p.quantidade }}</td>
              <td class="px-6 py-5 text-sm text-gray-900">{{ p.receitaEstimada }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="h-80 mx-auto max-w-lg" *ngIf="dadosCarregados">
        <canvas id="produtosChart"></canvas>
      </div>
    </section>

    <!-- 5. Vendas por Dia -->
    <section class="mb-12">
      <h2 class="text-2xl font-semibold text-indigo-700 border-b-2 border-indigo-200 pb-3 mb-6">5. Vendas por Dia</h2>
      <div class="overflow-x-auto mb-8">
        <table class="min-w-full bg-white border border-gray-200 rounded-lg">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Data</th>
              <th class="px-6 py-5 text-sm text-gray-900">Nº de Pedidos</th>
              <th class="px-6 py-5 text-sm text-gray-900">Faturamento Total (R$)</th>
              <th class="px-6 py-5 text-sm text-gray-900">Média por Pedido (R$)</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <tr *ngFor="let v of vendasPorDia">
              <td class="px-6 py-5 text-sm text-gray-900">{{ v.dia }}</td>
              <td class="px-6 py-5 text-sm text-gray-900">{{ v.pedidos }}</td>
              <td class="px-6 py-5 text-sm text-gray-900">R$ {{ v.faturamento }}</td>
              <td class="px-6 py-5 text-sm text-gray-900">R$ {{ v.media }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="mx-auto max-w-3xl">
          <h3 class="text-xl font-medium text-center mb-4 text-gray-800">Quantidade de Pedidos por Dia</h3>
          <div class="h-80" *ngIf="dadosCarregados">
            <canvas id="pedidosDiaChart"></canvas>
          </div>
        </div>
        <div class="mx-auto max-w-3xl">
          <h3 class="text-xl font-medium text-center mb-4 text-gray-800">Faturamento Total por Dia (R$)</h3>
          <div class="h-80" *ngIf="dadosCarregados">
            <canvas id="faturamentoDiaChart"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- 6. Vendas por Bairro -->
    <section class="mb-12">
      <h2 class="text-2xl font-semibold text-indigo-700 border-b-2 border-indigo-200 pb-3 mb-6">6. Vendas por Bairro (somente deliveries)</h2>
      <div class="overflow-x-auto mb-6">
        <table class="min-w-full bg-white border border-gray-200 rounded-lg">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Bairro</th>
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Nº de Pedidos</th>
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">% do total de deliveries</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <tr *ngFor="let b of bairrosData">
              <td class="px-6 py-5 text-sm text-gray-900">{{ b.bairro }}</td>
              <td class="px-6 py-5 text-sm text-gray-900">{{ b.pedidos }}</td>
              <td class="px-6 py-5 text-sm text-gray-900">{{ b.percentual }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="h-80 mx-auto max-w-3xl" *ngIf="dadosCarregados">
        <canvas id="bairrosChart"></canvas>
      </div>
    </section>

   

    <footer class="text-center text-gray-500 text-sm mt-16">
      Relatório gerado em Março de 2026 • Dados referentes a {{ nomeMes }}/{{ selectedYear }}
    </footer>
  </div>
</div>