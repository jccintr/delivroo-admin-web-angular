<div class="p-6 lg:p-8 min-h-screen bg-gray-50">
  <div class="mb-8">
    <h1 class="text-2xl lg:text-3xl font-bold text-gray-800">Pedidos</h1>
    <p class="text-gray-600 mt-1">Gerencie os pedidos da sua loja</p>
  </div>

   <!-- Loading -->
   @if(loading) {
         <div  class="text-center py-16 text-gray-500">
            <span class="material-icons animate-spin text-xl">autorenew</span>
            <p class="text-lg">Carregando pedidos...</p>
        </div>
   }

  <!-- Estado vazio -->
  <div *ngIf="(!pedidos || pedidos.length === 0 ) && !loading" class="text-center py-16 text-gray-500">
    <p class="text-lg">Nenhum pedido encontrado no momento.</p>
    <p class="mt-2">Novos pedidos aparecerão aqui automaticamente.</p>
  </div>

  <!-- Tabela -->
  <div *ngIf="pedidos && pedidos.length > 0" class="overflow-x-auto rounded-xl border border-gray-200 bg-white shadow-sm">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th scope="col" class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Pedido</th>
          <th scope="col" class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Data</th>
          <th scope="col" class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Cliente</th>
          <th scope="col" class="px-6 py-4 text-center text-sm font-semibold text-gray-900">Delivery</th>
          <th scope="col" class="px-6 py-4 text-right text-sm font-semibold text-gray-900">Total</th>
          <th scope="col" class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Status</th>
          <th scope="col" class="px-6 py-4 text-right text-sm font-semibold text-gray-900">Ações</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200 bg-white">
        <tr *ngFor="let pedido of pedidos" class="hover:bg-gray-50 transition-colors">
          <!-- Pedido -->
          <td class="whitespace-nowrap px-6 py-5 text-sm font-medium text-gray-900">
            #{{ pedido.token || '—' }}
          </td>

          <!-- Data -->
          <td class="whitespace-nowrap px-6 py-5 text-sm text-gray-600">
            {{ pedido.data }}
          </td>

          <!-- Cliente -->
          <td class="whitespace-nowrap px-6 py-5 text-sm text-gray-700">
            {{ pedido.nome }}
          </td>

          <!-- Delivery (chip) -->
          <td class="whitespace-nowrap px-6 py-5 text-center text-sm">
            <span 
              class="inline-flex items-center px-3 py-1 font-semibold"
              [ngClass]="{
                ' text-green-500': pedido.delivery === true,
                'text-red-500':   pedido.delivery !== true
              }">
              {{ pedido.delivery === true ? 'Entregar' : 'Retirar' }}
            </span>
          </td>

          <!-- Total (alinhado direita) -->
          <td class="whitespace-nowrap px-6 py-5 text-sm font-semibold text-gray-900 text-right">
            {{ getTotalExibidoFormatado(pedido) }}
          </td>

          <!-- Status -->
          <td class="whitespace-nowrap px-6 py-5">
            <button  (click)="alterarStatus(pedido)"
              class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium"
              [ngClass]="{
                'bg-amber-300 text-amber-800 ': pedido.status_pedido.descricao_curta === 'Novo',
                'bg-green-100 text-green-800 ': pedido.status_pedido.descricao_curta === 'Entregue' || pedido.status_pedido.descricao_curta === 'Retirado',
                'bg-blue-100 text-blue-800 ': pedido.status_pedido.descricao_curta === 'Em Preparação' || pedido.status_pedido.descricao_curta === 'pago',
                'bg-yellow-100 text-yellow-800 ': pedido.status_pedido.descricao_curta === 'Pendente' || pedido.status_pedido.descricao_curta === 'aguardando pagamento',
                'bg-purple-100 text-purple-800 ': pedido.status_pedido.descricao_curta === 'A caminho' || pedido.status_pedido.descricao_curta === 'Pronto',
                'bg-red-100 text-red-800 ': pedido.status_pedido.descricao_curta === 'Cancelado' || pedido.status_pedido.descricao_curta === 'Rejeitado' || pedido.status_pedido.descricao_curta === 'Devolvido',
               
              }">
              {{ pedido.status_pedido.descricao_curta }}
            </button>
          </td>

          <!-- Ações -->
          <td class="whitespace-nowrap px-6 py-5 text-right text-sm font-semibold space-x-4">
            <button 
              (click)="abrirModalDetalhes(pedido)"
              title="Visualizar pedido"
              class="text-indigo-600 hover:text-indigo-900 transition">
              <span class="material-icons">description</span>
            </button>
            <app-receipt 
              [pedido]="pedido"
              ></app-receipt>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Total de pedidos (alinhado esquerda) -->
  <div *ngIf="pedidos && pedidos.length > 0" class="mt-6 text-left text-sm text-gray-600">
    Total de pedidos: <span class="font-semibold text-gray-900">{{ pedidos.length }}</span>
  </div>
  <!-- Modal de status -->
    <app-modal-status
      *ngIf="showStatusModal && selectedPedidoForStatus"
      [pedidoId]="selectedPedidoForStatus.id"
      [token]="selectedPedidoForStatus.token"
      [currentStatusId]="selectedPedidoForStatus.status_pedido.id"
      (close)="showStatusModal = false; selectedPedidoForStatus = undefined"
      (statusChanged)="onStatusChanged($event)"
    ></app-modal-status>
    <!-- Modal de detalhes do pedido -->
    <app-modal-pedido
      *ngIf="showPedidoModal && selectedPedido"
      [pedido]="selectedPedido"
      (close)="fecharModalPedido()"
    ></app-modal-pedido>
</div>